<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:weibo="http://api.weibo.com/schema/weibo"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://api.weibo.com/schema/weibo http://api.weibo.com/schema/weibo.xsd ">
    <!-- datasources -->
    <bean id="commentBaseDataSource"  abstract="true">
        <property name="driverClass"><value>com.mysql.jdbc.Driver</value></property>
        <property name="minPoolSize"><value>${feed.db.comment.minPoolSize}</value></property>
        <property name="maxPoolSize"><value>${feed.db.common.maxPoolSize}</value></property>
        <property name="idleConnectionTestPeriod"><value>25</value></property>
        <property name="maxIdleTime"><value>180</value></property>
        <property name="breakAfterAcquireFailure"><value>false</value></property>
        <property name="acquireRetryAttempts"><value>30</value></property>
        <property name="acquireRetryDelay"><value>1000</value></property>
        <property name="maxConnectionAge"><value>7200</value></property>
        <property name="user"><value>${comment.timeline.datasource.user}</value></property>
        <property name="password"><value>${comment.timeline.datasource.password}</value></property>
    </bean>

    <bean id="tableContainer" class="cn.sina.api.data.dao.impl2.strategy.TableContainer">
        <property name="tablesItems">
            <map>
                <entry key="status_cmt" value-ref="status_cmt"/>
                <entry key="cmt_timeline" value-ref="cmt_timeline"/>
                <entry key="comment" value-ref="comment"/>
            </map>
        </property>
    </bean>

    <bean id="comment" class="cn.sina.api.data.dao.impl2.strategy.TableItem">
        <property name="itemName" value="comment"/>
        <property name="dbNamePrefix"  value="comment"/>
        <property name="dbCount"  value="32"/>

        <property name="tableNamePrefix" value="comment" />
        <property name="tableNamePostFix" value="yymmdd" /> <!-- 默认是索引 -->
        <property name="tableCount" value="1" />            <!-- 这个参数和tableNamePostFix有关系，如果是日期就不用了。 -->
        <property name="sqls">
            <map>
                <entry key="GET_CONTENT" value="select id, content from $db$.$tb$ where id=?"/>
                <entry key="GET_CONTENTS" value="select id, content from $db$.$tb$ where id in "/>
                <entry key="SAVE_CONTENT" value="insert into $db$.$tb$ (id, content) values(?, ?)"/>
                <entry key="UPDATE_CONTENT" value="update $db$.$tb$ set content=? where id=? and content!=?"/>
            </map>
        </property>
        <property name="jdbcTemplates">
            <list>
                <ref bean="comment_jdbctemplate_0"/>
                <ref bean="comment_jdbctemplate_1"/>
                <ref bean="comment_jdbctemplate_2"/>
                <ref bean="comment_jdbctemplate_3"/>
                <ref bean="comment_jdbctemplate_4"/>
                <ref bean="comment_jdbctemplate_5"/>
                <ref bean="comment_jdbctemplate_6"/>
                <ref bean="comment_jdbctemplate_7"/>
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline" class="cn.sina.api.data.dao.impl2.strategy.TableItem">
        <property name="itemName" value="cmt_timeline"/>
        <property name="dbNamePrefix"  value="cmt_timeline"/>
        <property name="dbCount"  value="32"/>

        <property name="tableNamePrefix" value="timeline" />
        <property name="tableNamePostFix" value="yymm" /> <!-- 默认是索引 -->
        <property name="tableCount" value="1" />            <!-- 这个参数和tableNamePostFix有关系，如果是日期就不用了。 -->
        <property name="sqls">
            <map>
                <entry key="UPDATE_TIMELINE_STATE" value="update $db$.$tb$ set vflag=?, mflag=? where uid=? and vflag in(0,6,7) and type in(1,2,4,50) and cmt_id=? and mflag!=? and vflag!=?"/>
                <entry key="GET_TIMELINE" value="select uid,vflag,type,cmt_id,mflag from $db$.$tb$ where uid=? and vflag=? order by cmt_id desc limit ?,?"/>
            </map>
        </property>
        <property name="jdbcTemplates">
            <list>
                <ref bean="cmt_timeline_jdbctemplate_0"/>
                <ref bean="cmt_timeline_jdbctemplate_1"/>
                <ref bean="cmt_timeline_jdbctemplate_2"/>
                <ref bean="cmt_timeline_jdbctemplate_3"/>
                <ref bean="cmt_timeline_jdbctemplate_4"/>
                <ref bean="cmt_timeline_jdbctemplate_5"/>
                <ref bean="cmt_timeline_jdbctemplate_6"/>
                <ref bean="cmt_timeline_jdbctemplate_7"/>
            </list>
        </property>
    </bean>

    <bean id="status_cmt" class="cn.sina.api.data.dao.impl2.strategy.TableItem">
        <property name="itemName" value="status_cmt"/>
        <property name="dbNamePrefix"  value="cmt_timeline"/>
        <property name="dbCount"  value="32"/>

        <property name="tableNamePrefix" value="status_cmt" />
        <property name="tableNamePostFix" value="yymm" /> <!-- 默认是索引 -->
        <property name="tableCount" value="1" />            <!-- 这个参数和tableNamePostFix有关系，如果是日期就不用了。 -->
        <property name="sqls">
            <map>
                <entry key="UPDATE_STATUS_CMT_STATE" value="update $db$.$tb$ set vflag = ?, mflag=? where status_id = ? and vflag in (0,6,7) and cmt_id = ? and mflag=? and vflag=?"/>
                <entry key="GET_STATUS_COMMENTMETA_ALL_IN_MONTH" value="select status_id,vflag,cmt_id,mflag,uid from $db$.$tb$ where status_id=? and vflag=? order by cmt_id asc"/>
            </map>
        </property>
        <property name="jdbcTemplates">
            <list>
                <ref bean="cmt_timeline_jdbctemplate_0"/>
                <ref bean="cmt_timeline_jdbctemplate_1"/>
                <ref bean="cmt_timeline_jdbctemplate_2"/>
                <ref bean="cmt_timeline_jdbctemplate_3"/>
                <ref bean="cmt_timeline_jdbctemplate_4"/>
                <ref bean="cmt_timeline_jdbctemplate_5"/>
                <ref bean="cmt_timeline_jdbctemplate_6"/>
                <ref bean="cmt_timeline_jdbctemplate_7"/>
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_0" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_0_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_0_s" />
            </list>
        </property>
    </bean>


    <bean id="cmt_timeline_jdbctemplate_1" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_1_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_1_s" />
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_2" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_2_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_2_s" />
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_3" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_3_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_3_s" />
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_4" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_4_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_4_s" />
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_5" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_5_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_5_s" />
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_6" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_6_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_6_s" />
            </list>
        </property>
    </bean>

    <bean id="cmt_timeline_jdbctemplate_7" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_cmt_timeline_7_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_cmt_timeline_7_s" />
            </list>
        </property>
    </bean>

    <weibo:mysql id="datasources_cmt_timeline_0_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_0.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_0_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_0.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_1_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_1.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_1_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_1.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_2_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_2.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_2_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_2.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_3_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_3.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_3_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_3.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_4_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_4.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_4_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_4.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_5_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_5.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_5_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_5.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_6_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_6.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_6_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_6.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_7_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.master_7.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_cmt_timeline_7_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.timeline.datasource.slave_7.jdbcUrl}</value></property>
    </weibo:mysql>

    <bean id="comment_jdbctemplate_0" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_0_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_0_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_1" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_1_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_1_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_2" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_2_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_2_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_3" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_3_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_3_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_4" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_4_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_4_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_5" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_5_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_5_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_6" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_6_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_6_s" />
            </list>
        </property>
    </bean>

    <bean id="comment_jdbctemplate_7" class="cn.sina.api.data.dao.util.JdbcTemplate">
        <property name="dataSource">
            <ref bean="datasources_comment_7_m" />
        </property>
        <property name="dataSourceSlaves">
            <list>
                <ref bean="datasources_comment_7_s" />
            </list>
        </property>
    </bean>

    <weibo:mysql id="datasources_comment_0_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_0.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_0_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_0.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_1_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_1.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_1_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_1.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_2_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_2.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_2_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_2.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_3_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_3.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_3_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_3.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_4_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_4.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_4_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_4.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_5_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_5.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_5_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_5.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_6_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_6.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_6_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_6.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_7_m"  parent="commentBaseDataSource" strategy="master">
        <property name="jdbcUrl"><value>${comment.content.datasource.master_7.jdbcUrl}</value></property>
    </weibo:mysql>
    <weibo:mysql id="datasources_comment_7_s"  parent="commentBaseDataSource" strategy="slave">
        <property name="jdbcUrl"><value>${comment.content.datasource.slave_7.jdbcUrl}</value></property>
    </weibo:mysql>
</beans>

